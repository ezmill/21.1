function Uploader(e,t,n){function r(){var t=$(e)[0];if(HasDragAndDrop&&e=="html"){t.addEventListener("dragenter",i,false);t.addEventListener("dragover",s,false);t.addEventListener("drop",o,false)}else{t.addEventListener("change",o,false)}}function i(e){e.stopPropagation();e.preventDefault();console.log("enter")}function s(e){e.stopPropagation();e.preventDefault();console.log("over")}function o(e){e.stopPropagation();e.preventDefault();var r=e.dataTransfer?e.dataTransfer.files:e.target.files;for(var i=0,s;s=r[i];i++){if(!s.type.match("image.*"))continue;if(t){t()}if(HasFileReader){var o=new FileReader;o.onload=function(e){n(e.target.result)};o.readAsDataURL(s)}else{Proxy.echo(s,function(e){n(e)})}break}}if(!$(e)[0])return;if(!n){n=t;t=null}r()}var HasFileReader=typeof window.FileReader!=="undefined";var HasDragAndDrop="draggable"in document.createElement("span");var Proxy={echo:function(e,t){var n=new XMLHttpRequest,r=new FormData;r.append("file",e);r.append("type",e.type);csrf_formdata(r);n.addEventListener("error",function(){console.log("error echoing file..")},false);n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){t(n.responseText)}};n.open("POST","/images/echo",true);n.send(r)}}